---
import '../styles/global.css'

interface Props {
  title?: string;
  description?: string;
}

const { 
  title = "Bibek Ghimire — Product Leader & Builder",
  description = "Senior Product Manager at Orbex Group. Building the next generation of autonomous robotics systems. Product strategy, engineering, and tinkering."
} = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <title>{title}</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6D49RNR7JR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-6D49RNR7JR');
    </script>
  </head>
  <body class="bg-bg text-text-primary antialiased">
    <!-- Custom cursor -->
    <div class="cursor" id="cursor"></div>
    <div class="cursor-dot" id="cursorDot"></div>
    
    <!-- Noise overlay -->
    <div class="noise-overlay"></div>

    <slot />

    <script>
      // ── Custom cursor ──
      const cursor = document.getElementById('cursor')!;
      const dot = document.getElementById('cursorDot')!;
      let mouseX = 0, mouseY = 0;
      let cursorX = 0, cursorY = 0;

      document.addEventListener('mousemove', (e) => {
        mouseX = e.clientX;
        mouseY = e.clientY;
        dot.style.left = mouseX + 'px';
        dot.style.top = mouseY + 'px';
      });

      function animateCursor() {
        cursorX += (mouseX - cursorX) * 0.15;
        cursorY += (mouseY - cursorY) * 0.15;
        cursor.style.left = cursorX + 'px';
        cursor.style.top = cursorY + 'px';
        requestAnimationFrame(animateCursor);
      }
      animateCursor();

      // Hover effect on interactive elements
      document.querySelectorAll('a, button, [data-hover]').forEach(el => {
        el.addEventListener('mouseenter', () => cursor.classList.add('hover'));
        el.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
      });

      // ── Scroll-triggered animations ──
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              // Add stagger delay based on data attribute
              const delay = entry.target.getAttribute('data-delay') || '0';
              (entry.target as HTMLElement).style.transitionDelay = delay + 'ms';
              entry.target.classList.add('visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1, rootMargin: '0px 0px -60px 0px' }
      );

      document.querySelectorAll('[data-animate], [data-animate-left]').forEach((el) => {
        observer.observe(el);
      });

      // ── Stat counter animation ──
      const counterObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const el = entry.target as HTMLElement;
              const target = parseInt(el.getAttribute('data-count') || '0');
              const suffix = el.getAttribute('data-suffix') || '';
              let current = 0;
              const increment = target / 40;
              const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                  current = target;
                  clearInterval(timer);
                }
                el.textContent = Math.floor(current) + suffix;
              }, 30);
              counterObserver.unobserve(el);
            }
          });
        },
        { threshold: 0.5 }
      );

      document.querySelectorAll('[data-count]').forEach(el => {
        counterObserver.observe(el);
      });
    </script>
  </body>
</html>
